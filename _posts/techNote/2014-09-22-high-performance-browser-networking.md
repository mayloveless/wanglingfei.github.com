---
layout:     post
title:      Web性能权威指南
category: techNote
description: Web性能权威指南 读书笔记
tags: HTML5 读书笔记
---
##网络技术概览

###第1章：延迟与带宽

###第2章：TPC的构成

**性能检查清单**

    把服务器内核升级到最新版本
    确保cwnd大小为10
    禁用空闲后的慢启动
    确保启动窗口缩放
    减少传输冗余数据
    压缩要传输的数据
    把服务器放到离用户近的地方以减少往返时间
    尽最大可能重用已经建立的TCP连接

###第3章：UDP的构成

**针对UDP的优化建议**

    应用程序必须容忍各种因特网路径条件
    应用程序应该控制传输速度
    应用程序应该对所有流量进行拥塞控制
    应用程序应该使用与TCP相近的带宽
    应用程序应该准备基于丢包的重发计数器
    应用程序应该不发送大于路径MTU的数据报
    应用程序应该处理数据包丢失、重复和重排
    应用程序应该足够稳定以支持2分钟以上的交付延迟
    应用程序应该支持IPv4 UDP 校验和，必须支持IPv6校验和
    应用程序可以在需要时使用keep-alive（最小间隔15s）

**WebRTC满足上述要求:)**

###第4章：传输层安全（TLS）

TLS协议是SSL协议的升级版

TLS协议的目标是为在它之上运行的应用提供三个基本服务：加密，身份验证和数据完整性。
    
    加密：混淆数据的机制
    身份验证：验证身份标识有效性的机制
    完整性：检测消息是否被篡改或伪造的机制

TLS连接在TCP连接基础上多两个连接，服务器向客户端提供它的公钥，客户端生成对称密钥并使用服务器的公钥对其加密，然后再将加密的对称密钥返回服务器。服务器继而用自己的私钥解密出客户端发来的对称密钥，验证MAC(消息认证码）。接下来，客户端与服务器间的通信就全部都使用客户端生成的共享密钥加密，这就是对称密钥加密。公钥加密系统只建立在TLS信道的会话当中。

**信任链与证书颁发机构**

    张三与李四之间的认证：
    张三和李四分别生成自己的公钥和私钥
    张三和李四分别隐藏自己的私钥
    张三向李四公开自己的公钥，李四也向张三公开自己的公钥
    张三向李四发送一条新消息，并用自己的私钥签名
    李四使用张三的公钥验证收到的消息签名。
    张三未见过王五，但王五用李四的私钥签署了自己的公钥，并在消息中附上了签名，这样形成了信任链。

**性能检查清单**

    要最大限度提升TCP性能
    把TLS库升级到最新版本，在此基础上构建（或重新构建）服务器
    启动并配置会话缓存和无状态恢复
    监控会话缓存的使用情况并作出相应调整
    在接近用户的地方完成TLS会话，尽量减少往返延迟
    配置TLS记录大小，使其恰好能封装在一个TLS段内
    确保证书链不会超过拥塞窗口的大小
    从信任链中去掉不必要的证书，减少链条层次
    禁用服务器的TLS压缩功能
    启动服务器对SNI的支持
    启动服务器的OCSP封套功能
    追加HTTP严格传输安全首部。

##无线网络性能

###第5章：无线网络概论 

**影响无线网络性能的因素**

    收发端的距离
    当前位置的背景噪音大小
    来自同一网络（小区）其他用户的干扰大小
    来自相邻网络（小区）其他用户的干扰大小
    两端发射功率大小
    处理能力及调制算法

###第6章：Wi-Fi

###第7章：移动网络

###第8章：移动网络的优化建议

**1、节约用电**
    
    全功率打开无线电模块只消几个小时就可耗尽电量
    对无线电功率的需求随着无线标准演进与代剧增
    无线电模块的耗电量仅次于设备的屏幕
    数据传输时无线电通信的耗电过程是非线性的。

**2、消除周期性及无效的数据传输**

    轮询在移动网络中的代价极高，少用
    尽可能使用推送和通知
    出站和入站请求应该合并和汇总
    非关键性请求应该推迟到无线模块活动时进行
    （消除不必要的长连接）

**3、预测网络延迟上限**

    考虑RRC状态切换
    解耦用户交互与网络通信

**4、面对多网络接口并存的现实**

    不要缓存或试图猜测网络状态
    调度请求、监听并诊断错误
    瞬态错误总会发生，不可忽视，可以采取重试策略
    监听连接状态，以便采用最佳请求方式
    对重试请求采用补偿算法，不要永远循环
    离线时，进可能记录并在将来发送请求
    利用HTML5的AppCache和localStorage实现离线应用

**5、爆发传输数据并转为空闲**

    如果需要大型音频或视频文件，考虑提前下载整个文件，而不要以比特为单位地流式下载
    预先取得应用内容，通过测量和统计工具来辨别什么内容适合提前下载
    预先取得第三方内容，比如广告，通过应用逻辑提前显示并更新它们的状态。
    允许设备关闭无线模块，保持其空闲，不要忘了优化和消除间歇性传输。

**6、把负载转移到Wi-Fi网络**

##第三部分：HTTP

###第9章：HTTP简史

###第10章：Web性能要点

**性能来源：计算、渲染和网络访问**
    
    更多带宽其实不太重要
    延迟是性能瓶颈

**针对浏览器的优化建议**

    基于文档的优化：熟悉网络协议，了解文档、Css和JS解析管道，发现和优先安排关键网络资源，尽早分派请求并取得页面，使其尽快达到可交互的状态。主要方法是优先获取资源、提前解析
    推测性能优化：浏览器可以学习用户的导航模式，执行推测性优化，尝试预测用户的下一次操作。然后，预先解析DNS、预先连接可能的目标

**以上浏览器已经自动完成，主要利用以下4种技术**
    
    资源预取和排定优先次序：文档、Css和Js解析器可以与网络协议层沟通，声明每种资源的优先级：初始渲染必需的阻塞资源具有最高优先级，而低优先级的请求可能会被临时保存在队列中。
    DNS预解析：对可能的域名进行提前解析，避免将来HTTP请求时的DNS延迟。预解析可以通过学习导航历史、用户的鼠标悬停，或其他页面信号来触发。
    TCP预连接：DNS解析后，浏览器可以根据预测的HTTP请求，推测性地打开TCP连接。如果猜对的话，则可以节省一次完整的往返（TCP握手）时间。
    页面预渲染：某些浏览器可以让我们提示下一个可能的目标，从而在隐藏的标签页中预先渲染整个页面。这样，当用户真的触发导航时，就能立即切换过来。

    <link refl="dns-prefetch" href="//hostname_to_resolve.com">//预解析特定域名
    <link refl="subresource" href="/javascript/myapp.js">//预取得页面后面要用到的关键性资源
    <link refl="prefetch" href="/images/big.jpg">//预取得将来导航要用的资源
    <link refl="prefetch" href="//example.org/next_page.html">//根据对用户下一个目标的预测，预渲染特定页面。

###第11章：HTTP 1.x

###第12章：HTTP 2.0

**设计和技术目标**

1、二进制分帧层

    HTTP 1.x以换行符作为纯文本的分隔符，而HTTP2.0将所有传输的信息分割为更小的消息和帧，并对它们采用二级制格式编码。

2、流、消息和帧
    
    流：已建立的连接上的双向字节流
    消息：与逻辑消息对应的完整的一系列数据帧
    帧：HTTP2.0通信的最小单位，每个帧包含首部，至少也会标识出当前帧所属的流。

**所有HTTP2.0通信都在一个连接上完成，这个链接可以承载任意数量的双向数据流，相应地，每个数据流以消息的形式发送，而消息由一个或多个帧组成，这些帧可以乱序发送，然后再根据每个首部的流标识符重新组装。**

    所有通信都在一个TCP连接完成
    流时连接中的一个虚拟信道，可以承载双向的消息；每个流都有一个唯一的整数标识符（1、2……N）
    消息是指逻辑上的HTTP消息，比如请求，响应等，由一个或多个帧组成
    帧是通信的最小单位，承载着特定类型的数据，如HTTP头部、负荷等等。



















